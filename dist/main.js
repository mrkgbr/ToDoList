(()=>{"use strict";const t=document.querySelector("body");function e(){return JSON.parse(localStorage.getItem("toDos"))||[]}function n(t){if(document.querySelector(".todo").textContent="",t)return void t.forEach(((t,e)=>{new o(t.id,e,t.task,t.description,t.date,t.completed,t.project,t.priority)}));const n=e();n.forEach(((t,e)=>{new o(e,e,t.task,t.description,t.date,t.completed,t.project,t.priority),n[e].id=e,localStorage.setItem("toDos",JSON.stringify(n))}))}class o{constructor(t,e,n,o,s,c,a,i){this.id=t,this.listId=e,this.title=n,this.description=o,this.date=s,this.completed=c,this.project=a,this.priority=i,this.#t()}createTaskContainer(t){const e=document.createElement("div");switch(e.classList.add("task-container"),e.setAttribute("id",this.id),t.appendChild(e),this.priority){case"1":e.classList.add("prio1");break;case"2":e.classList.add("prio2");break;case"3":e.classList.add("prio3");break;default:console.log("black")}return e}#t(){const t=document.querySelector(".todo"),o=this.createTaskContainer(t),s=document.createElement("form");s.classList.add("task-form"),o.appendChild(s);const c=document.createElement("input");c.setAttribute("type","text"),c.setAttribute("name","taskTitle"),c.value=this.title,c.classList.add("task-title"),c.readOnly=!0,s.appendChild(c);const a=document.createElement("textarea");a.setAttribute("name","taskDescription"),a.value=this.description,a.classList.add("task-description"),a.readOnly=!0,s.appendChild(a);const i=document.createElement("input");i.setAttribute("type","date"),i.setAttribute("name","taskDate"),i.value=this.date,i.classList.add("task-date"),i.readOnly=!0,s.appendChild(i);const r=document.createElement("select");r.classList.add("task-selector"),r.disabled=!0,s.appendChild(r),document.querySelectorAll("#project-select option").forEach((t=>{const e=document.createElement("option");e.value=t.value,e.textContent=t.label,this.project===t.value&&e.setAttribute("selected","selected"),r.appendChild(e)}));const d=document.createElement("input");d.setAttribute("type","submit"),d.value="EDIT",d.classList.add("edit-button"),s.appendChild(d),d.addEventListener("click",(t=>{t.preventDefault(),d.value="SAVE",c.readOnly=!1,c.classList.toggle("edit"),a.readOnly=!1,a.classList.toggle("edit"),i.readOnly=!1,i.classList.toggle("edit"),r.disabled=!1,d.addEventListener("click",(t=>{t.preventDefault(),d.value="EDIT",c.readOnly=!0,c.classList.toggle("edit"),a.readOnly=!0,a.classList.toggle("edit"),i.readOnly=!0,r.disabled=!0,i.classList.toggle("edit");const o=e();o[this.id].task=s.taskTitle.value,o[this.id].description=s.taskDescription.value,o[this.id].date=s.taskDate.value,o[this.id].project=r.value,localStorage.setItem("toDos",JSON.stringify(o)),n()}))}));const l=document.createElement("button");l.textContent="DEL",l.classList.add("delete-button"),s.appendChild(l),l.addEventListener("click",(t=>{t.preventDefault();const n=e();n.splice(this.id,1),document.querySelectorAll(".task-container")[this.listId].remove(),localStorage.setItem("toDos",JSON.stringify(n))}))}}class s{static projects=[{name:"Inbox",protected:!0},{name:"Today",protected:!0}];static renderProjects(){this.parseProjects().forEach((t=>{this.createProject(t)}))}static parseProjects(){let t=JSON.parse(localStorage.getItem("projectList"))||[];return 0===t.length&&(t=this.projects,localStorage.setItem("projectList",JSON.stringify(t))),t}static addProjects(t){const e=JSON.parse(localStorage.getItem("projectList"));e.push(t),localStorage.setItem("projectList",JSON.stringify(e))}static removeProjects(t){const e=JSON.parse(localStorage.getItem("projectList"));e.splice(t,1),localStorage.setItem("projectList",JSON.stringify(e)),document.querySelectorAll(".project")[t].remove(),document.querySelectorAll("#project-select option")[t-1].remove(),n()}static createProject(t){const o=document.querySelector(".project-container"),s=document.createElement("div");s.classList.add("project"),s.setAttribute("id",t.name),o.appendChild(s);const c=document.createElement("p");if(c.textContent=t.name,s.appendChild(c),!t.protected){const e=document.createElement("button");e.textContent="DEL",s.appendChild(e),e.addEventListener("click",(()=>{const e=this.parseProjects().findIndex((e=>e.name===t.name));this.removeProjects(e)}))}if("Inbox"!==t.name&&"Today"!==t.name&&"Late"!==t.name){const e=document.querySelector("#project-select"),n=document.createElement("option");n.value=t.name.toLowerCase(),n.textContent=t.name,e.appendChild(n)}c.addEventListener("click",(()=>{const o=e();"Inbox"!==t.name?"Today"!==t.name?n(o.filter((e=>e.project===t.name.toLowerCase()))):n(o.filter((t=>{const e=(new Date).toJSON(),n=Date.parse(e);return Date.parse(t.date)<n}))):n()}))}static newProject(t){this.createProject(t),this.addProjects(t),n()}}!function(){const e=document.createElement("div");e.classList.add("sidebar"),t.appendChild(e);const n=document.createElement("button");n.classList.add("new-button"),n.textContent="Create Task",e.appendChild(n);const o=document.createElement("button");o.classList.add("project-button"),o.textContent="Add Project",e.appendChild(o);const s=document.createElement("div");s.classList.add("project-container"),e.appendChild(s)}(),function(){const e=document.createElement("div");e.classList.add("todo"),t.appendChild(e)}(),function(){const e=document.createElement("div");e.classList.add("form-container"),e.classList.add("hidden"),t.appendChild(e);const n=document.createElement("div");n.classList.add("form-main"),e.appendChild(n);const o=document.createElement("form");o.classList.add("form"),n.appendChild(o);const s=document.createElement("label");s.setAttribute("for","task"),s.textContent="Task Title",o.appendChild(s);const c=document.createElement("input");c.setAttribute("type","text"),c.setAttribute("id","task"),c.setAttribute("name","task"),c.setAttribute("placeholder","e.g. walk the dog"),c.setAttribute("required",""),o.appendChild(c);const a=document.createElement("label");a.setAttribute("for","description"),a.textContent="Description",o.appendChild(a);const i=document.createElement("textarea");i.setAttribute("id","description"),i.setAttribute("name","description"),i.setAttribute("rows","6"),i.setAttribute("maxlength","200"),o.appendChild(i);const r=document.createElement("label");r.setAttribute("for","datum"),r.textContent="Due date",o.appendChild(r);const d=document.createElement("input");d.setAttribute("type","date"),d.setAttribute("id","datum"),d.setAttribute("name","datum"),o.appendChild(d);const l=document.createElement("select");l.setAttribute("id","project-select"),l.setAttribute("name","projectselect"),o.appendChild(l);const u=document.createElement("option");u.value="default",u.textContent="-",l.appendChild(u);const p=document.createElement("select");p.setAttribute("id","priority-select"),p.setAttribute("name","priorityselect"),o.appendChild(p);const m=document.createElement("option");m.value="1",m.textContent="1",p.appendChild(m);const h=document.createElement("option");h.value="2",h.textContent="2",p.appendChild(h);const b=document.createElement("option");b.value="3",b.textContent="3",p.appendChild(b);const C=document.createElement("input");C.setAttribute("type","submit"),C.setAttribute("id","submit"),C.setAttribute("value","Add"),o.appendChild(C);const v=document.createElement("button");v.setAttribute("id","cancel"),v.textContent="Cancel",o.appendChild(v)}(),document.querySelector("#cancel").addEventListener("click",(t=>{t.preventDefault(),document.querySelector(".form-container").classList.toggle("hidden");const e=document.querySelector(".form");e.task.value="",e.description.value="",e.datum.value=""})),document.querySelector("#submit").addEventListener("click",(t=>{t.preventDefault(),document.querySelector(".form-container").classList.toggle("hidden");const o=document.querySelector(".form");!function(t){const o=e(),s={task:t.task.value,description:t.description.value,date:t.datum.value,completed:!1,project:t.projectselect.value,priority:t.priorityselect.value};o.push(s),localStorage.setItem("toDos",JSON.stringify(o)),n()}(o),o.reset(),n()})),document.querySelector(".new-button").addEventListener("click",(()=>{document.querySelector(".form-container").classList.toggle("hidden")})),document.querySelector(".project-button").addEventListener("click",(()=>{const t=prompt("Please enter a project name:","New Project");if(!t)return;const e={name:t,protected:!1};s.newProject(e)})),s.renderProjects(),n()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoibUJBQUEsTUFBTUEsRUFBT0MsU0FBU0MsY0FBYyxRQ0NwQyxTQUFTQyxJQUNQLE9BQU9DLEtBQUtDLE1BQU1DLGFBQWFDLFFBQVEsV0FBYSxFQUN0RCxDQUVBLFNBQVNDLEVBQU9DLEdBSWQsR0FIY1IsU0FBU0MsY0FBYyxTQUMvQlEsWUFBYyxHQUVoQkQsRUFlRixZQWRjQSxFQUNSRSxTQUFRLENBQUNDLEVBQU1DLEtBRWpCLElBQUlDLEVBQ0ZGLEVBQUtDLEdBQ0xBLEVBQ0FELEVBQUtHLEtBQ0xILEVBQUtJLFlBQ0xKLEVBQUtLLEtBQ0xMLEVBQUtNLFVBQ0xOLEVBQUtPLFFBQ0xQLEVBQUtRLFNBQ0gsSUFLVixNQUFNQyxFQUFRbEIsSUFDZGtCLEVBQU1WLFNBQVEsQ0FBQ0MsRUFBTUMsS0FFakIsSUFBSUMsRUFDRkQsRUFDQUEsRUFDQUQsRUFBS0csS0FDTEgsRUFBS0ksWUFDTEosRUFBS0ssS0FDTEwsRUFBS00sVUFDTE4sRUFBS08sUUFDTFAsRUFBS1EsVUFFVEMsRUFBTVIsR0FBSUEsR0FBS0EsRUFDZlAsYUFBYWdCLFFBQVEsUUFBU2xCLEtBQUttQixVQUFVRixHQUFPLEdBRXhELENBRUEsTUFBTVAsRUFDSlUsWUFDRVgsRUFDQVksRUFDQUMsRUFDQVYsRUFDQUMsRUFDQUMsRUFDQUMsRUFDQUMsR0FFQU8sS0FBS2QsR0FBS0EsRUFDVmMsS0FBS0YsT0FBU0EsRUFDZEUsS0FBS0QsTUFBUUEsRUFDYkMsS0FBS1gsWUFBY0EsRUFDbkJXLEtBQUtWLEtBQU9BLEVBQ1pVLEtBQUtULFVBQVlBLEVBQ2pCUyxLQUFLUixRQUFVQSxFQUNmUSxLQUFLUCxTQUFXQSxFQUNoQk8sTUFBSyxHQUNQLENBRUFDLG9CQUFvQkMsR0FFbEIsTUFBTWQsRUFBT2QsU0FBUzZCLGNBQWMsT0FJcEMsT0FIQWYsRUFBS2dCLFVBQVVDLElBQUksa0JBQ25CakIsRUFBS2tCLGFBQWEsS0FBTU4sS0FBS2QsSUFDN0JnQixFQUFNSyxZQUFZbkIsR0FDVlksS0FBS1AsVUFDWCxJQUFLLElBQ0hMLEVBQUtnQixVQUFVQyxJQUFJLFNBQ25CLE1BQ0YsSUFBSyxJQUNIakIsRUFBS2dCLFVBQVVDLElBQUksU0FDbkIsTUFDRixJQUFLLElBQ0hqQixFQUFLZ0IsVUFBVUMsSUFBSSxTQUNuQixNQUNGLFFBQ0VHLFFBQVFDLElBQUksU0FHaEIsT0FBT3JCLENBQ1QsQ0FHQSxLQUNFLE1BQU1jLEVBQVE1QixTQUFTQyxjQUFjLFNBRS9CYSxFQUFPWSxLQUFLQyxvQkFBb0JDLEdBR2hDUSxFQUFXcEMsU0FBUzZCLGNBQWMsUUFDeENPLEVBQVNOLFVBQVVDLElBQUksYUFDdkJqQixFQUFLbUIsWUFBWUcsR0FHakIsTUFBTVgsRUFBUXpCLFNBQVM2QixjQUFjLFNBQ3JDSixFQUFNTyxhQUFhLE9BQVEsUUFDM0JQLEVBQU1PLGFBQWEsT0FBUSxhQUMzQlAsRUFBTVksTUFBUVgsS0FBS0QsTUFDbkJBLEVBQU1LLFVBQVVDLElBQUksY0FDcEJOLEVBQU1hLFVBQVcsRUFDakJGLEVBQVNILFlBQVlSLEdBR3JCLE1BQU1WLEVBQWNmLFNBQVM2QixjQUFjLFlBQzNDZCxFQUFZaUIsYUFBYSxPQUFRLG1CQUNqQ2pCLEVBQVlzQixNQUFRWCxLQUFLWCxZQUN6QkEsRUFBWWUsVUFBVUMsSUFBSSxvQkFDMUJoQixFQUFZdUIsVUFBVyxFQUN2QkYsRUFBU0gsWUFBWWxCLEdBR3JCLE1BQU1DLEVBQU9oQixTQUFTNkIsY0FBYyxTQUNwQ2IsRUFBS2dCLGFBQWEsT0FBUSxRQUMxQmhCLEVBQUtnQixhQUFhLE9BQVEsWUFDMUJoQixFQUFLcUIsTUFBUVgsS0FBS1YsS0FDbEJBLEVBQUtjLFVBQVVDLElBQUksYUFDbkJmLEVBQUtzQixVQUFXLEVBQ2hCRixFQUFTSCxZQUFZakIsR0FHckIsTUFBTXVCLEVBQWdCdkMsU0FBUzZCLGNBQWMsVUFDN0NVLEVBQWNULFVBQVVDLElBQUksaUJBQzVCUSxFQUFjQyxVQUFXLEVBQ3pCSixFQUFTSCxZQUFZTSxHQUNGdkMsU0FBU3lDLGlCQUFpQiwwQkFDbEMvQixTQUFTZ0MsSUFDbEIsTUFBTUMsRUFBWTNDLFNBQVM2QixjQUFjLFVBQ3pDYyxFQUFVTixNQUFRSyxFQUFJTCxNQUN0Qk0sRUFBVWxDLFlBQWNpQyxFQUFJRSxNQUN4QmxCLEtBQUtSLFVBQVl3QixFQUFJTCxPQUN2Qk0sRUFBVVgsYUFBYSxXQUFZLFlBRXJDTyxFQUFjTixZQUFZVSxFQUFVLElBSXRDLE1BQU1FLEVBQVU3QyxTQUFTNkIsY0FBYyxTQUN2Q2dCLEVBQVFiLGFBQWEsT0FBUSxVQUM3QmEsRUFBUVIsTUFBUSxPQUNoQlEsRUFBUWYsVUFBVUMsSUFBSSxlQUN0QkssRUFBU0gsWUFBWVksR0FFckJBLEVBQVFDLGlCQUFpQixTQUFVQyxJQUNqQ0EsRUFBRUMsaUJBQ0ZILEVBQVFSLE1BQVEsT0FDaEJaLEVBQU1hLFVBQVcsRUFDakJiLEVBQU1LLFVBQVVtQixPQUFPLFFBQ3ZCbEMsRUFBWXVCLFVBQVcsRUFDdkJ2QixFQUFZZSxVQUFVbUIsT0FBTyxRQUM3QmpDLEVBQUtzQixVQUFXLEVBQ2hCdEIsRUFBS2MsVUFBVW1CLE9BQU8sUUFDdEJWLEVBQWNDLFVBQVcsRUFFekJLLEVBQVFDLGlCQUFpQixTQUFVSSxJQUNqQ0EsRUFBTUYsaUJBQ05ILEVBQVFSLE1BQVEsT0FDaEJaLEVBQU1hLFVBQVcsRUFDakJiLEVBQU1LLFVBQVVtQixPQUFPLFFBQ3ZCbEMsRUFBWXVCLFVBQVcsRUFDdkJ2QixFQUFZZSxVQUFVbUIsT0FBTyxRQUM3QmpDLEVBQUtzQixVQUFXLEVBQ2hCQyxFQUFjQyxVQUFXLEVBRXpCeEIsRUFBS2MsVUFBVW1CLE9BQU8sUUFDdEIsTUFBTUUsRUFBT2pELElBQ2JpRCxFQUFLekIsS0FBS2QsSUFBSUUsS0FBT3NCLEVBQVNnQixVQUFVZixNQUN4Q2MsRUFBS3pCLEtBQUtkLElBQUlHLFlBQWNxQixFQUFTaUIsZ0JBQWdCaEIsTUFDckRjLEVBQUt6QixLQUFLZCxJQUFJSSxLQUFPb0IsRUFBU2tCLFNBQVNqQixNQUN2Q2MsRUFBS3pCLEtBQUtkLElBQUlNLFFBQVVxQixFQUFjRixNQUN0Q2hDLGFBQWFnQixRQUFRLFFBQVNsQixLQUFLbUIsVUFBVTZCLElBQzdDNUMsR0FBUSxHQUNSLElBSUosTUFBTWdELEVBQVl2RCxTQUFTNkIsY0FBYyxVQUN6QzBCLEVBQVU5QyxZQUFjLE1BQ3hCOEMsRUFBVXpCLFVBQVVDLElBQUksaUJBQ3hCSyxFQUFTSCxZQUFZc0IsR0FFckJBLEVBQVVULGlCQUFpQixTQUFVVSxJQUNuQ0EsRUFBSVIsaUJBQ0osTUFBTUcsRUFBT2pELElBQ2JpRCxFQUFLTSxPQUFPL0IsS0FBS2QsR0FBSSxHQUNyQlosU0FBU3lDLGlCQUFpQixtQkFBbUJmLEtBQUtGLFFBQVFrQyxTQUMxRHJELGFBQWFnQixRQUFRLFFBQVNsQixLQUFLbUIsVUFBVTZCLEdBQU0sR0FHdkQsRUNsTWEsTUFBTVEsRUFDbkJDLGdCQUFrQixDQUNoQixDQUNFQyxLQUFNLFFBQ05DLFdBQVcsR0FFYixDQUNFRCxLQUFNLFFBQ05DLFdBQVcsSUFJZkYsd0JBQ2dCbEMsS0FBS3FDLGdCQUNickQsU0FBU0MsSUFDYmUsS0FBS3NDLGNBQWNyRCxFQUFLLEdBRzVCLENBRUFpRCx1QkFDRSxJQUFJSyxFQUFROUQsS0FBS0MsTUFBTUMsYUFBYUMsUUFBUSxpQkFBbUIsR0FLL0QsT0FKcUIsSUFBakIyRCxFQUFNQyxTQUNSRCxFQUFRdkMsS0FBS3lDLFNBQ2I5RCxhQUFhZ0IsUUFBUSxjQUFlbEIsS0FBS21CLFVBQVUyQyxLQUU5Q0EsQ0FDVCxDQUVBTCxtQkFBbUJqRCxHQUNqQixNQUFNc0QsRUFBUTlELEtBQUtDLE1BQU1DLGFBQWFDLFFBQVEsZ0JBQzlDMkQsRUFBTUcsS0FBS3pELEdBQ1hOLGFBQWFnQixRQUFRLGNBQWVsQixLQUFLbUIsVUFBVTJDLEdBQ3JELENBRUFMLHNCQUFzQlMsR0FDcEIsTUFBTUosRUFBUTlELEtBQUtDLE1BQU1DLGFBQWFDLFFBQVEsZ0JBQzlDMkQsRUFBTVIsT0FBT1ksRUFBTyxHQUNwQmhFLGFBQWFnQixRQUFRLGNBQWVsQixLQUFLbUIsVUFBVTJDLElBQ25EakUsU0FBU3lDLGlCQUFpQixZQUFZNEIsR0FBT1gsU0FDN0MxRCxTQUFTeUMsaUJBQWlCLDBCQUEwQjRCLEVBQVEsR0FBR1gsU0FDL0RuRCxHQUNGLENBRUFxRCxxQkFBcUJqRCxHQUNuQixNQUFNMkQsRUFBbUJ0RSxTQUFTQyxjQUFjLHNCQUMxQ3NFLEVBQWN2RSxTQUFTNkIsY0FBYyxPQUMzQzBDLEVBQVl6QyxVQUFVQyxJQUFJLFdBQzFCd0MsRUFBWXZDLGFBQWEsS0FBTXJCLEVBQUtrRCxNQUNwQ1MsRUFBaUJyQyxZQUFZc0MsR0FDN0IsTUFBTXJELEVBQVVsQixTQUFTNkIsY0FBYyxLQUl2QyxHQUhBWCxFQUFRVCxZQUFjRSxFQUFLa0QsS0FDM0JVLEVBQVl0QyxZQUFZZixJQUVuQlAsRUFBS21ELFVBQVcsQ0FDbkIsTUFBTVUsRUFBZ0J4RSxTQUFTNkIsY0FBYyxVQUM3QzJDLEVBQWMvRCxZQUFjLE1BQzVCOEQsRUFBWXRDLFlBQVl1QyxHQUN4QkEsRUFBYzFCLGlCQUFpQixTQUFTLEtBQ3RDLE1BQ011QixFQURXM0MsS0FBS3FDLGdCQUNDVSxXQUNwQkMsR0FBY0EsRUFBVWIsT0FBU2xELEVBQUtrRCxPQUV6Q25DLEtBQUtpRCxlQUFlTixFQUFNLEdBRTlCLENBRUEsR0FDZ0IsVUFBZDFELEVBQUtrRCxNQUNTLFVBQWRsRCxFQUFLa0QsTUFDUyxTQUFkbEQsRUFBS2tELEtBQ0wsQ0FDQSxNQUFNZSxFQUFTNUUsU0FBU0MsY0FBYyxtQkFDaEMwQyxFQUFZM0MsU0FBUzZCLGNBQWMsVUFDekNjLEVBQVVOLE1BQVExQixFQUFLa0QsS0FBS2dCLGNBQzVCbEMsRUFBVWxDLFlBQWNFLEVBQUtrRCxLQUM3QmUsRUFBTzNDLFlBQVlVLEVBQ3JCLENBRUF6QixFQUFRNEIsaUJBQWlCLFNBQVMsS0FDaEMsTUFBTWdDLEVBQVk1RSxJQUNBLFVBQWRTLEVBQUtrRCxLQUtTLFVBQWRsRCxFQUFLa0QsS0FjVHRELEVBSHFCdUUsRUFBVUMsUUFDNUJDLEdBQWNBLEVBQVU5RCxVQUFZUCxFQUFLa0QsS0FBS2dCLGlCQUwvQ3RFLEVBTnFCdUUsRUFBVUMsUUFBUUMsSUFDckMsTUFBTWhFLEdBQU8sSUFBSWlFLE1BQU9DLFNBQ2xCQyxFQUFjRixLQUFLN0UsTUFBTVksR0FFL0IsT0FEc0JpRSxLQUFLN0UsTUFBTTRFLEVBQVVoRSxNQUNwQm1FLENBQVcsS0FUcEM1RSxHQWtCa0IsR0FFeEIsQ0FFQXFELGtCQUFrQmpELEdBQ2hCZSxLQUFLc0MsY0FBY3JELEdBQ25CZSxLQUFLMEQsWUFBWXpFLEdBQ2pCSixHQUNGLEdGdEdGLFdBQ0UsTUFBTThFLEVBQU1yRixTQUFTNkIsY0FBYyxPQUNuQ3dELEVBQUl2RCxVQUFVQyxJQUFJLFdBQ2xCaEMsRUFBS2tDLFlBQVlvRCxHQUVqQixNQUFNQyxFQUFZdEYsU0FBUzZCLGNBQWMsVUFDekN5RCxFQUFVeEQsVUFBVUMsSUFBSSxjQUN4QnVELEVBQVU3RSxZQUFjLGNBQ3hCNEUsRUFBSXBELFlBQVlxRCxHQUVoQixNQUFNQyxFQUFtQnZGLFNBQVM2QixjQUFjLFVBQ2hEMEQsRUFBaUJ6RCxVQUFVQyxJQUFJLGtCQUMvQndELEVBQWlCOUUsWUFBYyxjQUMvQjRFLEVBQUlwRCxZQUFZc0QsR0FFaEIsTUFBTWpCLEVBQW1CdEUsU0FBUzZCLGNBQWMsT0FDaER5QyxFQUFpQnhDLFVBQVVDLElBQUkscUJBQy9Cc0QsRUFBSXBELFlBQVlxQyxFQUNsQixDQWdHRWtCLEdBeEhGLFdBQ0UsTUFBTUgsRUFBTXJGLFNBQVM2QixjQUFjLE9BQ25Dd0QsRUFBSXZELFVBQVVDLElBQUksUUFDbEJoQyxFQUFLa0MsWUFBWW9ELEVBQ25CLENBc0hFSSxHQWhHRixXQUVFLE1BQU1DLEVBQVkxRixTQUFTNkIsY0FBYyxPQUN6QzZELEVBQVU1RCxVQUFVQyxJQUFJLGtCQUN4QjJELEVBQVU1RCxVQUFVQyxJQUFJLFVBQ3hCaEMsRUFBS2tDLFlBQVl5RCxHQUVqQixNQUFNQyxFQUFPM0YsU0FBUzZCLGNBQWMsT0FDcEM4RCxFQUFLN0QsVUFBVUMsSUFBSSxhQUNuQjJELEVBQVV6RCxZQUFZMEQsR0FHdEIsTUFBTUMsRUFBTzVGLFNBQVM2QixjQUFjLFFBQ3BDK0QsRUFBSzlELFVBQVVDLElBQUksUUFDbkI0RCxFQUFLMUQsWUFBWTJELEdBR2pCLE1BQU1DLEVBQVk3RixTQUFTNkIsY0FBYyxTQUN6Q2dFLEVBQVU3RCxhQUFhLE1BQU8sUUFDOUI2RCxFQUFVcEYsWUFBYyxhQUN4Qm1GLEVBQUszRCxZQUFZNEQsR0FDakIsTUFBTS9FLEVBQU9kLFNBQVM2QixjQUFjLFNBQ3BDZixFQUFLa0IsYUFBYSxPQUFRLFFBQzFCbEIsRUFBS2tCLGFBQWEsS0FBTSxRQUN4QmxCLEVBQUtrQixhQUFhLE9BQVEsUUFDMUJsQixFQUFLa0IsYUFBYSxjQUFlLHFCQUNqQ2xCLEVBQUtrQixhQUFhLFdBQVksSUFDOUI0RCxFQUFLM0QsWUFBWW5CLEdBR2pCLE1BQU1nRixFQUFtQjlGLFNBQVM2QixjQUFjLFNBQ2hEaUUsRUFBaUI5RCxhQUFhLE1BQU8sZUFDckM4RCxFQUFpQnJGLFlBQWMsY0FDL0JtRixFQUFLM0QsWUFBWTZELEdBQ2pCLE1BQU0vRSxFQUFjZixTQUFTNkIsY0FBYyxZQUMzQ2QsRUFBWWlCLGFBQWEsS0FBTSxlQUMvQmpCLEVBQVlpQixhQUFhLE9BQVEsZUFDakNqQixFQUFZaUIsYUFBYSxPQUFRLEtBQ2pDakIsRUFBWWlCLGFBQWEsWUFBYSxPQUN0QzRELEVBQUszRCxZQUFZbEIsR0FHakIsTUFBTWdGLEVBQWEvRixTQUFTNkIsY0FBYyxTQUMxQ2tFLEVBQVcvRCxhQUFhLE1BQU8sU0FDL0IrRCxFQUFXdEYsWUFBYyxXQUN6Qm1GLEVBQUszRCxZQUFZOEQsR0FDakIsTUFBTUMsRUFBUWhHLFNBQVM2QixjQUFjLFNBQ3JDbUUsRUFBTWhFLGFBQWEsT0FBUSxRQUMzQmdFLEVBQU1oRSxhQUFhLEtBQU0sU0FDekJnRSxFQUFNaEUsYUFBYSxPQUFRLFNBQzNCNEQsRUFBSzNELFlBQVkrRCxHQUdqQixNQUFNcEIsRUFBUzVFLFNBQVM2QixjQUFjLFVBQ3RDK0MsRUFBTzVDLGFBQWEsS0FBTSxrQkFDMUI0QyxFQUFPNUMsYUFBYSxPQUFRLGlCQUM1QjRELEVBQUszRCxZQUFZMkMsR0FDakIsTUFBTXFCLEVBQWdCakcsU0FBUzZCLGNBQWMsVUFDN0NvRSxFQUFjNUQsTUFBUSxVQUN0QjRELEVBQWN4RixZQUFjLElBQzVCbUUsRUFBTzNDLFlBQVlnRSxHQUduQixNQUFNQyxFQUFpQmxHLFNBQVM2QixjQUFjLFVBQzlDcUUsRUFBZWxFLGFBQWEsS0FBTSxtQkFDbENrRSxFQUFlbEUsYUFBYSxPQUFRLGtCQUNwQzRELEVBQUszRCxZQUFZaUUsR0FDakIsTUFBTUMsRUFBWW5HLFNBQVM2QixjQUFjLFVBQ3pDc0UsRUFBVTlELE1BQVEsSUFDbEI4RCxFQUFVMUYsWUFBYyxJQUN4QnlGLEVBQWVqRSxZQUFZa0UsR0FDM0IsTUFBTUMsRUFBWXBHLFNBQVM2QixjQUFjLFVBQ3pDdUUsRUFBVS9ELE1BQVEsSUFDbEIrRCxFQUFVM0YsWUFBYyxJQUN4QnlGLEVBQWVqRSxZQUFZbUUsR0FDM0IsTUFBTUMsRUFBY3JHLFNBQVM2QixjQUFjLFVBQzNDd0UsRUFBWWhFLE1BQVEsSUFDcEJnRSxFQUFZNUYsWUFBYyxJQUMxQnlGLEVBQWVqRSxZQUFZb0UsR0FHM0IsTUFBTUMsRUFBWXRHLFNBQVM2QixjQUFjLFNBQ3pDeUUsRUFBVXRFLGFBQWEsT0FBUSxVQUMvQnNFLEVBQVV0RSxhQUFhLEtBQU0sVUFDN0JzRSxFQUFVdEUsYUFBYSxRQUFTLE9BQ2hDNEQsRUFBSzNELFlBQVlxRSxHQUVqQixNQUFNQyxFQUFldkcsU0FBUzZCLGNBQWMsVUFDNUMwRSxFQUFhdkUsYUFBYSxLQUFNLFVBQ2hDdUUsRUFBYTlGLFlBQWMsU0FDM0JtRixFQUFLM0QsWUFBWXNFLEVBQ25CLENBTUVDLEdHeEhleEcsU0FBU0MsY0FBYyxXQUMvQjZDLGlCQUFpQixTQUFVQyxJQUNoQ0EsRUFBRUMsaUJBQ29CaEQsU0FBU0MsY0FBYyxtQkFFL0I2QixVQUFVbUIsT0FBTyxVQUMvQixNQUFNMkMsRUFBTzVGLFNBQVNDLGNBQWMsU0FFcEMyRixFQUFLOUUsS0FBS3VCLE1BQVEsR0FDbEJ1RCxFQUFLN0UsWUFBWXNCLE1BQVEsR0FDekJ1RCxFQUFLSSxNQUFNM0QsTUFBUSxFQUFFLElBTVhyQyxTQUFTQyxjQUFjLFdBQy9CNkMsaUJBQWlCLFNBQVVDLElBQzdCQSxFQUFFQyxpQkFDb0JoRCxTQUFTQyxjQUFjLG1CQUMvQjZCLFVBQVVtQixPQUFPLFVBQy9CLE1BQU0yQyxFQUFPNUYsU0FBU0MsY0FBYyxVRjZLeEMsU0FBa0IyRixHQUNoQixNQUFNeEUsRUFBUWxCLElBQ1J1RyxFQUFPLENBQ1gzRixLQUFNOEUsRUFBSzlFLEtBQUt1QixNQUNoQnRCLFlBQWE2RSxFQUFLN0UsWUFBWXNCLE1BQzlCckIsS0FBTTRFLEVBQUtJLE1BQU0zRCxNQUNqQnBCLFdBQVcsRUFDWEMsUUFBUzBFLEVBQUtjLGNBQWNyRSxNQUM1QmxCLFNBQVV5RSxFQUFLZSxlQUFldEUsT0FFaENqQixFQUFNZ0QsS0FBS3FDLEdBQ1hwRyxhQUFhZ0IsUUFBUSxRQUFTbEIsS0FBS21CLFVBQVVGLElBQzdDYixHQUNGLENFekxJcUcsQ0FBU2hCLEdBRVRBLEVBQUtpQixRQUNMdEcsR0FBUSxJQU1LUCxTQUFTQyxjQUFjLGVBQy9CNkMsaUJBQWlCLFNBQVMsS0FDVDlDLFNBQVNDLGNBQWMsbUJBQy9CNkIsVUFBVW1CLE9BQU8sU0FBUyxJQU12QmpELFNBQVNDLGNBQWMsbUJBQy9CNkMsaUJBQWlCLFNBQVMsS0FDbkMsTUFBTWdFLEVBQWNDLE9BQU8sK0JBQWdDLGVBQzNELElBQUtELEVBQ0gsT0FFRixNQUFNRSxFQUFhLENBQ2pCbkQsS0FBTWlELEVBQ05oRCxXQUFXLEdBRWJILEVBQVNzRCxXQUFXRCxFQUFXLElDaERuQ3JELEVBQVN1RCxpQkFDVDNHLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2RvbGlzdC8uL3NyYy9tb2R1bGVzL3VpLmpzIiwid2VicGFjazovL3RvZG9saXN0Ly4vc3JjL21vZHVsZXMvdG9kby5qcyIsIndlYnBhY2s6Ly90b2RvbGlzdC8uL3NyYy9tb2R1bGVzL3Byb2plY3RzLmpzIiwid2VicGFjazovL3RvZG9saXN0Ly4vc3JjL21vZHVsZXMvYnV0dG9uLWZ1bmN0aW9ucy5qcyIsIndlYnBhY2s6Ly90b2RvbGlzdC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIik7XG5cbmZ1bmN0aW9uIGNyZWF0ZVRvZG8oKSB7XG4gIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIGRpdi5jbGFzc0xpc3QuYWRkKFwidG9kb1wiKTtcbiAgYm9keS5hcHBlbmRDaGlsZChkaXYpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVTaWRlYmFyKCkge1xuICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBkaXYuY2xhc3NMaXN0LmFkZChcInNpZGViYXJcIik7XG4gIGJvZHkuYXBwZW5kQ2hpbGQoZGl2KTtcblxuICBjb25zdCBuZXdCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICBuZXdCdXR0b24uY2xhc3NMaXN0LmFkZChcIm5ldy1idXR0b25cIik7XG4gIG5ld0J1dHRvbi50ZXh0Q29udGVudCA9IFwiQ3JlYXRlIFRhc2tcIjtcbiAgZGl2LmFwcGVuZENoaWxkKG5ld0J1dHRvbik7XG5cbiAgY29uc3QgYWRkUHJvamVjdEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gIGFkZFByb2plY3RCdXR0b24uY2xhc3NMaXN0LmFkZChcInByb2plY3QtYnV0dG9uXCIpO1xuICBhZGRQcm9qZWN0QnV0dG9uLnRleHRDb250ZW50ID0gXCJBZGQgUHJvamVjdFwiO1xuICBkaXYuYXBwZW5kQ2hpbGQoYWRkUHJvamVjdEJ1dHRvbik7XG5cbiAgY29uc3QgcHJvamVjdENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIHByb2plY3RDb250YWluZXIuY2xhc3NMaXN0LmFkZChcInByb2plY3QtY29udGFpbmVyXCIpO1xuICBkaXYuYXBwZW5kQ2hpbGQocHJvamVjdENvbnRhaW5lcik7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUZvcm0oKSB7XG4gIC8vIGFkZCBjb250YWluZXIgZGl2XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiZm9ybS1jb250YWluZXJcIik7XG4gIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICBib2R5LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG4gIC8vIGFkZCBjb250YWluZXIgZGl2XG4gIGNvbnN0IG1haW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBtYWluLmNsYXNzTGlzdC5hZGQoXCJmb3JtLW1haW5cIik7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZChtYWluKTtcblxuICAvLyBhZGQgZm9ybVxuICBjb25zdCBmb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImZvcm1cIik7XG4gIGZvcm0uY2xhc3NMaXN0LmFkZChcImZvcm1cIik7XG4gIG1haW4uYXBwZW5kQ2hpbGQoZm9ybSk7XG5cbiAgLy8gYWRkIHRhc2sgbmFtZVxuICBjb25zdCB0YXNrTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGFiZWxcIik7XG4gIHRhc2tMYWJlbC5zZXRBdHRyaWJ1dGUoXCJmb3JcIiwgXCJ0YXNrXCIpO1xuICB0YXNrTGFiZWwudGV4dENvbnRlbnQgPSBcIlRhc2sgVGl0bGVcIjtcbiAgZm9ybS5hcHBlbmRDaGlsZCh0YXNrTGFiZWwpO1xuICBjb25zdCB0YXNrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICB0YXNrLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJ0ZXh0XCIpO1xuICB0YXNrLnNldEF0dHJpYnV0ZShcImlkXCIsIFwidGFza1wiKTtcbiAgdGFzay5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIFwidGFza1wiKTtcbiAgdGFzay5zZXRBdHRyaWJ1dGUoXCJwbGFjZWhvbGRlclwiLCBcImUuZy4gd2FsayB0aGUgZG9nXCIpO1xuICB0YXNrLnNldEF0dHJpYnV0ZShcInJlcXVpcmVkXCIsIFwiXCIpO1xuICBmb3JtLmFwcGVuZENoaWxkKHRhc2spO1xuXG4gIC8vIGFkZCBkZXNjcmlwdGlvblxuICBjb25zdCBkZXNjcmlwdGlvbkxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxhYmVsXCIpO1xuICBkZXNjcmlwdGlvbkxhYmVsLnNldEF0dHJpYnV0ZShcImZvclwiLCBcImRlc2NyaXB0aW9uXCIpO1xuICBkZXNjcmlwdGlvbkxhYmVsLnRleHRDb250ZW50ID0gXCJEZXNjcmlwdGlvblwiO1xuICBmb3JtLmFwcGVuZENoaWxkKGRlc2NyaXB0aW9uTGFiZWwpO1xuICBjb25zdCBkZXNjcmlwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZXh0YXJlYVwiKTtcbiAgZGVzY3JpcHRpb24uc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJkZXNjcmlwdGlvblwiKTtcbiAgZGVzY3JpcHRpb24uc2V0QXR0cmlidXRlKFwibmFtZVwiLCBcImRlc2NyaXB0aW9uXCIpO1xuICBkZXNjcmlwdGlvbi5zZXRBdHRyaWJ1dGUoXCJyb3dzXCIsIFwiNlwiKTtcbiAgZGVzY3JpcHRpb24uc2V0QXR0cmlidXRlKFwibWF4bGVuZ3RoXCIsIFwiMjAwXCIpO1xuICBmb3JtLmFwcGVuZENoaWxkKGRlc2NyaXB0aW9uKTtcblxuICAvLyBhZGQgZGF0ZVxuICBjb25zdCBkYXR1bUxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxhYmVsXCIpO1xuICBkYXR1bUxhYmVsLnNldEF0dHJpYnV0ZShcImZvclwiLCBcImRhdHVtXCIpO1xuICBkYXR1bUxhYmVsLnRleHRDb250ZW50ID0gXCJEdWUgZGF0ZVwiO1xuICBmb3JtLmFwcGVuZENoaWxkKGRhdHVtTGFiZWwpO1xuICBjb25zdCBkYXR1bSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgZGF0dW0uc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImRhdGVcIik7XG4gIGRhdHVtLnNldEF0dHJpYnV0ZShcImlkXCIsIFwiZGF0dW1cIik7XG4gIGRhdHVtLnNldEF0dHJpYnV0ZShcIm5hbWVcIiwgXCJkYXR1bVwiKTtcbiAgZm9ybS5hcHBlbmRDaGlsZChkYXR1bSk7XG5cbiAgLy8gYWRkIHNlbGVjdFxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpO1xuICBzZWxlY3Quc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJwcm9qZWN0LXNlbGVjdFwiKTtcbiAgc2VsZWN0LnNldEF0dHJpYnV0ZShcIm5hbWVcIiwgXCJwcm9qZWN0c2VsZWN0XCIpO1xuICBmb3JtLmFwcGVuZENoaWxkKHNlbGVjdCk7XG4gIGNvbnN0IG9wdGlvbkRlZmF1bHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICBvcHRpb25EZWZhdWx0LnZhbHVlID0gXCJkZWZhdWx0XCI7XG4gIG9wdGlvbkRlZmF1bHQudGV4dENvbnRlbnQgPSBcIi1cIjtcbiAgc2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbkRlZmF1bHQpO1xuXG4gIC8vIGFkZCBwcmlvcml0eVxuICBjb25zdCBwcmlvcml0eVNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XG4gIHByaW9yaXR5U2VsZWN0LnNldEF0dHJpYnV0ZShcImlkXCIsIFwicHJpb3JpdHktc2VsZWN0XCIpO1xuICBwcmlvcml0eVNlbGVjdC5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIFwicHJpb3JpdHlzZWxlY3RcIik7XG4gIGZvcm0uYXBwZW5kQ2hpbGQocHJpb3JpdHlTZWxlY3QpO1xuICBjb25zdCBvcHRpb25PbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICBvcHRpb25PbmUudmFsdWUgPSBcIjFcIjtcbiAgb3B0aW9uT25lLnRleHRDb250ZW50ID0gXCIxXCI7XG4gIHByaW9yaXR5U2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbk9uZSk7XG4gIGNvbnN0IG9wdGlvblR3byA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XG4gIG9wdGlvblR3by52YWx1ZSA9IFwiMlwiO1xuICBvcHRpb25Ud28udGV4dENvbnRlbnQgPSBcIjJcIjtcbiAgcHJpb3JpdHlTZWxlY3QuYXBwZW5kQ2hpbGQob3B0aW9uVHdvKTtcbiAgY29uc3Qgb3B0aW9uVGhyZWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICBvcHRpb25UaHJlZS52YWx1ZSA9IFwiM1wiO1xuICBvcHRpb25UaHJlZS50ZXh0Q29udGVudCA9IFwiM1wiO1xuICBwcmlvcml0eVNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb25UaHJlZSk7XG5cbiAgLy8gYWRkIGJ1dHRvblxuICBjb25zdCBhZGRCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gIGFkZEJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwic3VibWl0XCIpO1xuICBhZGRCdXR0b24uc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJzdWJtaXRcIik7XG4gIGFkZEJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ2YWx1ZVwiLCBcIkFkZFwiKTtcbiAgZm9ybS5hcHBlbmRDaGlsZChhZGRCdXR0b24pO1xuICAvLyBjYW5jZWwgYnV0dG9uXG4gIGNvbnN0IGNhbmNlbEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gIGNhbmNlbEJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBcImNhbmNlbFwiKTtcbiAgY2FuY2VsQnV0dG9uLnRleHRDb250ZW50ID0gXCJDYW5jZWxcIjtcbiAgZm9ybS5hcHBlbmRDaGlsZChjYW5jZWxCdXR0b24pO1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVTdHJ1Y3R1cmUoKSB7XG4gIGNyZWF0ZVNpZGViYXIoKTtcbiAgLy8gY3JlYXRlSGVhZGVyKCk7XG4gIGNyZWF0ZVRvZG8oKTtcbiAgY3JlYXRlRm9ybSgpO1xufVxuIiwiLy8gZ2V0IGl0ZW1zIGZyb20gbG9jYWwgc3RvcmFnZVxuZnVuY3Rpb24gcGFyc2VMb2NhbFN0b3JhZ2UoKSB7XG4gIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidG9Eb3NcIikpIHx8IFtdO1xufVxuLy8gcmVuZGVyIHRhc2tzIGZyb20gbG9jYWwgc3RvcmFnZVxuZnVuY3Rpb24gcmVuZGVyKGxpc3QpIHtcbiAgY29uc3QgaW5ib3ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRvZG9cIik7XG4gIGluYm94LnRleHRDb250ZW50ID0gXCJcIjtcblxuICBpZiAobGlzdCkge1xuICAgIGNvbnN0IHRvRG9zID0gbGlzdDtcbiAgICB0b0Rvcy5mb3JFYWNoKChpdGVtLCBpZCkgPT4ge1xuICAgICAgKCgpID0+XG4gICAgICAgIG5ldyBUYXNrKFxuICAgICAgICAgIGl0ZW0uaWQsXG4gICAgICAgICAgaWQsXG4gICAgICAgICAgaXRlbS50YXNrLFxuICAgICAgICAgIGl0ZW0uZGVzY3JpcHRpb24sXG4gICAgICAgICAgaXRlbS5kYXRlLFxuICAgICAgICAgIGl0ZW0uY29tcGxldGVkLFxuICAgICAgICAgIGl0ZW0ucHJvamVjdCxcbiAgICAgICAgICBpdGVtLnByaW9yaXR5XG4gICAgICAgICkpKCk7XG4gICAgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgdG9Eb3MgPSBwYXJzZUxvY2FsU3RvcmFnZSgpO1xuICB0b0Rvcy5mb3JFYWNoKChpdGVtLCBpZCkgPT4ge1xuICAgICgoKSA9PlxuICAgICAgbmV3IFRhc2soXG4gICAgICAgIGlkLFxuICAgICAgICBpZCxcbiAgICAgICAgaXRlbS50YXNrLFxuICAgICAgICBpdGVtLmRlc2NyaXB0aW9uLFxuICAgICAgICBpdGVtLmRhdGUsXG4gICAgICAgIGl0ZW0uY29tcGxldGVkLFxuICAgICAgICBpdGVtLnByb2plY3QsXG4gICAgICAgIGl0ZW0ucHJpb3JpdHlcbiAgICAgICkpKCk7XG4gICAgdG9Eb3NbaWRdLmlkID0gaWQ7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ0b0Rvc1wiLCBKU09OLnN0cmluZ2lmeSh0b0RvcykpO1xuICB9KTtcbn1cbi8vIGNyZWF0ZSB0YXNrc1xuY2xhc3MgVGFzayB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIGlkLFxuICAgIGxpc3RJZCxcbiAgICB0aXRsZSxcbiAgICBkZXNjcmlwdGlvbixcbiAgICBkYXRlLFxuICAgIGNvbXBsZXRlZCxcbiAgICBwcm9qZWN0LFxuICAgIHByaW9yaXR5XG4gICkge1xuICAgIHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLmxpc3RJZCA9IGxpc3RJZDtcbiAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgIHRoaXMuZGF0ZSA9IGRhdGU7XG4gICAgdGhpcy5jb21wbGV0ZWQgPSBjb21wbGV0ZWQ7XG4gICAgdGhpcy5wcm9qZWN0ID0gcHJvamVjdDtcbiAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgdGhpcy4jY3JlYXRlKCk7XG4gIH1cblxuICBjcmVhdGVUYXNrQ29udGFpbmVyKGluYm94KSB7XG4gICAgLy8gdGFzayBjb250YWluZXJcbiAgICBjb25zdCB0YXNrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0YXNrLmNsYXNzTGlzdC5hZGQoXCJ0YXNrLWNvbnRhaW5lclwiKTtcbiAgICB0YXNrLnNldEF0dHJpYnV0ZShcImlkXCIsIHRoaXMuaWQpO1xuICAgIGluYm94LmFwcGVuZENoaWxkKHRhc2spO1xuICAgIHN3aXRjaCAodGhpcy5wcmlvcml0eSkge1xuICAgICAgY2FzZSBcIjFcIjpcbiAgICAgICAgdGFzay5jbGFzc0xpc3QuYWRkKFwicHJpbzFcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIjJcIjpcbiAgICAgICAgdGFzay5jbGFzc0xpc3QuYWRkKFwicHJpbzJcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIjNcIjpcbiAgICAgICAgdGFzay5jbGFzc0xpc3QuYWRkKFwicHJpbzNcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY29uc29sZS5sb2coXCJibGFja1wiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiB0YXNrO1xuICB9XG5cbiAgLy8gY3JlYXRlIHRhc2sgdWkgYW5kIGZ1bmN0aW9uc1xuICAjY3JlYXRlKCkge1xuICAgIGNvbnN0IGluYm94ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50b2RvXCIpO1xuICAgIC8vIHRhc2sgY29udGFpbmVyXG4gICAgY29uc3QgdGFzayA9IHRoaXMuY3JlYXRlVGFza0NvbnRhaW5lcihpbmJveCk7XG5cbiAgICAvLyB0YXNrIGZvcm1cbiAgICBjb25zdCB0YXNrRm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpO1xuICAgIHRhc2tGb3JtLmNsYXNzTGlzdC5hZGQoXCJ0YXNrLWZvcm1cIik7XG4gICAgdGFzay5hcHBlbmRDaGlsZCh0YXNrRm9ybSk7XG5cbiAgICAvLyB0YXNrIHRpdGxlXG4gICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgdGl0bGUuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInRleHRcIik7XG4gICAgdGl0bGUuc2V0QXR0cmlidXRlKFwibmFtZVwiLCBcInRhc2tUaXRsZVwiKTtcbiAgICB0aXRsZS52YWx1ZSA9IHRoaXMudGl0bGU7XG4gICAgdGl0bGUuY2xhc3NMaXN0LmFkZChcInRhc2stdGl0bGVcIik7XG4gICAgdGl0bGUucmVhZE9ubHkgPSB0cnVlO1xuICAgIHRhc2tGb3JtLmFwcGVuZENoaWxkKHRpdGxlKTtcblxuICAgIC8vIHRhc2sgZGVzY3JpcHRpb25cbiAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZXh0YXJlYVwiKTtcbiAgICBkZXNjcmlwdGlvbi5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIFwidGFza0Rlc2NyaXB0aW9uXCIpO1xuICAgIGRlc2NyaXB0aW9uLnZhbHVlID0gdGhpcy5kZXNjcmlwdGlvbjtcbiAgICBkZXNjcmlwdGlvbi5jbGFzc0xpc3QuYWRkKFwidGFzay1kZXNjcmlwdGlvblwiKTtcbiAgICBkZXNjcmlwdGlvbi5yZWFkT25seSA9IHRydWU7XG4gICAgdGFza0Zvcm0uYXBwZW5kQ2hpbGQoZGVzY3JpcHRpb24pO1xuXG4gICAgLy8gdGFzayBkYXRlXG4gICAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgICBkYXRlLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJkYXRlXCIpO1xuICAgIGRhdGUuc2V0QXR0cmlidXRlKFwibmFtZVwiLCBcInRhc2tEYXRlXCIpO1xuICAgIGRhdGUudmFsdWUgPSB0aGlzLmRhdGU7XG4gICAgZGF0ZS5jbGFzc0xpc3QuYWRkKFwidGFzay1kYXRlXCIpO1xuICAgIGRhdGUucmVhZE9ubHkgPSB0cnVlO1xuICAgIHRhc2tGb3JtLmFwcGVuZENoaWxkKGRhdGUpO1xuXG4gICAgLy8gcHJvamVjdCBzZWxlY3RvclxuICAgIGNvbnN0IHByb2plY3RTZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpO1xuICAgIHByb2plY3RTZWxlY3QuY2xhc3NMaXN0LmFkZChcInRhc2stc2VsZWN0b3JcIik7XG4gICAgcHJvamVjdFNlbGVjdC5kaXNhYmxlZCA9IHRydWU7XG4gICAgdGFza0Zvcm0uYXBwZW5kQ2hpbGQocHJvamVjdFNlbGVjdCk7XG4gICAgY29uc3QgYWxsT3B0aW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIjcHJvamVjdC1zZWxlY3Qgb3B0aW9uXCIpO1xuICAgIGFsbE9wdGlvbnMuZm9yRWFjaCgob3B0KSA9PiB7XG4gICAgICBjb25zdCBuZXdPcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICAgICAgbmV3T3B0aW9uLnZhbHVlID0gb3B0LnZhbHVlO1xuICAgICAgbmV3T3B0aW9uLnRleHRDb250ZW50ID0gb3B0LmxhYmVsO1xuICAgICAgaWYgKHRoaXMucHJvamVjdCA9PT0gb3B0LnZhbHVlKSB7XG4gICAgICAgIG5ld09wdGlvbi5zZXRBdHRyaWJ1dGUoXCJzZWxlY3RlZFwiLCBcInNlbGVjdGVkXCIpO1xuICAgICAgfVxuICAgICAgcHJvamVjdFNlbGVjdC5hcHBlbmRDaGlsZChuZXdPcHRpb24pO1xuICAgIH0pO1xuXG4gICAgLy8gdGFzayBlZGl0IGJ1dHRvbiBhbmQgZnVuY3Rpb25zXG4gICAgY29uc3QgZWRpdEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgICBlZGl0QnRuLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJzdWJtaXRcIik7XG4gICAgZWRpdEJ0bi52YWx1ZSA9IFwiRURJVFwiO1xuICAgIGVkaXRCdG4uY2xhc3NMaXN0LmFkZChcImVkaXQtYnV0dG9uXCIpO1xuICAgIHRhc2tGb3JtLmFwcGVuZENoaWxkKGVkaXRCdG4pO1xuXG4gICAgZWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGVkaXRCdG4udmFsdWUgPSBcIlNBVkVcIjtcbiAgICAgIHRpdGxlLnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgICB0aXRsZS5jbGFzc0xpc3QudG9nZ2xlKFwiZWRpdFwiKTtcbiAgICAgIGRlc2NyaXB0aW9uLnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgICBkZXNjcmlwdGlvbi5jbGFzc0xpc3QudG9nZ2xlKFwiZWRpdFwiKTtcbiAgICAgIGRhdGUucmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgIGRhdGUuY2xhc3NMaXN0LnRvZ2dsZShcImVkaXRcIik7XG4gICAgICBwcm9qZWN0U2VsZWN0LmRpc2FibGVkID0gZmFsc2U7XG5cbiAgICAgIGVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlZGl0QnRuLnZhbHVlID0gXCJFRElUXCI7XG4gICAgICAgIHRpdGxlLnJlYWRPbmx5ID0gdHJ1ZTtcbiAgICAgICAgdGl0bGUuY2xhc3NMaXN0LnRvZ2dsZShcImVkaXRcIik7XG4gICAgICAgIGRlc2NyaXB0aW9uLnJlYWRPbmx5ID0gdHJ1ZTtcbiAgICAgICAgZGVzY3JpcHRpb24uY2xhc3NMaXN0LnRvZ2dsZShcImVkaXRcIik7XG4gICAgICAgIGRhdGUucmVhZE9ubHkgPSB0cnVlO1xuICAgICAgICBwcm9qZWN0U2VsZWN0LmRpc2FibGVkID0gdHJ1ZTtcblxuICAgICAgICBkYXRlLmNsYXNzTGlzdC50b2dnbGUoXCJlZGl0XCIpO1xuICAgICAgICBjb25zdCBkYXRhID0gcGFyc2VMb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgZGF0YVt0aGlzLmlkXS50YXNrID0gdGFza0Zvcm0udGFza1RpdGxlLnZhbHVlO1xuICAgICAgICBkYXRhW3RoaXMuaWRdLmRlc2NyaXB0aW9uID0gdGFza0Zvcm0udGFza0Rlc2NyaXB0aW9uLnZhbHVlO1xuICAgICAgICBkYXRhW3RoaXMuaWRdLmRhdGUgPSB0YXNrRm9ybS50YXNrRGF0ZS52YWx1ZTtcbiAgICAgICAgZGF0YVt0aGlzLmlkXS5wcm9qZWN0ID0gcHJvamVjdFNlbGVjdC52YWx1ZTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ0b0Rvc1wiLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgIHJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyB0YXNrIGRlbGV0ZSBidXR0b24gYW5kIGZ1bmN0aW9uc1xuICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgZGVsZXRlQnRuLnRleHRDb250ZW50ID0gXCJERUxcIjtcbiAgICBkZWxldGVCdG4uY2xhc3NMaXN0LmFkZChcImRlbGV0ZS1idXR0b25cIik7XG4gICAgdGFza0Zvcm0uYXBwZW5kQ2hpbGQoZGVsZXRlQnRuKTtcblxuICAgIGRlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGRlbCkgPT4ge1xuICAgICAgZGVsLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCBkYXRhID0gcGFyc2VMb2NhbFN0b3JhZ2UoKTtcbiAgICAgIGRhdGEuc3BsaWNlKHRoaXMuaWQsIDEpO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50YXNrLWNvbnRhaW5lclwiKVt0aGlzLmxpc3RJZF0ucmVtb3ZlKCk7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInRvRG9zXCIsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgIC8vIHJlbmRlcigpO1xuICAgIH0pO1xuICB9XG59XG4vLyBzYXZlIG5ldyB0YXNrIHRvIHRoZSBsb2NhTCBzdG9yYWdlXG5mdW5jdGlvbiBzYXZlVG9Ebyhmb3JtKSB7XG4gIGNvbnN0IHRvRG9zID0gcGFyc2VMb2NhbFN0b3JhZ2UoKTtcbiAgY29uc3QgdG9EbyA9IHtcbiAgICB0YXNrOiBmb3JtLnRhc2sudmFsdWUsXG4gICAgZGVzY3JpcHRpb246IGZvcm0uZGVzY3JpcHRpb24udmFsdWUsXG4gICAgZGF0ZTogZm9ybS5kYXR1bS52YWx1ZSxcbiAgICBjb21wbGV0ZWQ6IGZhbHNlLFxuICAgIHByb2plY3Q6IGZvcm0ucHJvamVjdHNlbGVjdC52YWx1ZSxcbiAgICBwcmlvcml0eTogZm9ybS5wcmlvcml0eXNlbGVjdC52YWx1ZSxcbiAgfTtcbiAgdG9Eb3MucHVzaCh0b0RvKTtcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ0b0Rvc1wiLCBKU09OLnN0cmluZ2lmeSh0b0RvcykpO1xuICByZW5kZXIoKTtcbn1cblxuZXhwb3J0IHsgc2F2ZVRvRG8sIFRhc2ssIHJlbmRlciwgcGFyc2VMb2NhbFN0b3JhZ2UgfTtcbiIsImltcG9ydCB7IHBhcnNlTG9jYWxTdG9yYWdlLCByZW5kZXIgfSBmcm9tIFwiLi90b2RvXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2plY3RzIHtcbiAgc3RhdGljIHByb2plY3RzID0gW1xuICAgIHtcbiAgICAgIG5hbWU6IFwiSW5ib3hcIixcbiAgICAgIHByb3RlY3RlZDogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6IFwiVG9kYXlcIixcbiAgICAgIHByb3RlY3RlZDogdHJ1ZSxcbiAgICB9LFxuICBdO1xuXG4gIHN0YXRpYyByZW5kZXJQcm9qZWN0cygpIHtcbiAgICBjb25zdCBpdGVtcyA9IHRoaXMucGFyc2VQcm9qZWN0cygpO1xuICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIHRoaXMuY3JlYXRlUHJvamVjdChpdGVtKTtcbiAgICB9KTtcbiAgICAvLyB0aGlzLm5ld1Byb2plY3QoeyBuYW1lOiBcIkR1bW15XCIsIHByb3RlY3RlZDogZmFsc2UgfSk7XG4gIH1cblxuICBzdGF0aWMgcGFyc2VQcm9qZWN0cygpIHtcbiAgICBsZXQgaXRlbXMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicHJvamVjdExpc3RcIikpIHx8IFtdO1xuICAgIGlmIChpdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGl0ZW1zID0gdGhpcy5wcm9qZWN0cztcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwicHJvamVjdExpc3RcIiwgSlNPTi5zdHJpbmdpZnkoaXRlbXMpKTtcbiAgICB9XG4gICAgcmV0dXJuIGl0ZW1zO1xuICB9XG5cbiAgc3RhdGljIGFkZFByb2plY3RzKGl0ZW0pIHtcbiAgICBjb25zdCBpdGVtcyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJwcm9qZWN0TGlzdFwiKSk7XG4gICAgaXRlbXMucHVzaChpdGVtKTtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInByb2plY3RMaXN0XCIsIEpTT04uc3RyaW5naWZ5KGl0ZW1zKSk7XG4gIH1cblxuICBzdGF0aWMgcmVtb3ZlUHJvamVjdHMoaW5kZXgpIHtcbiAgICBjb25zdCBpdGVtcyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJwcm9qZWN0TGlzdFwiKSk7XG4gICAgaXRlbXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInByb2plY3RMaXN0XCIsIEpTT04uc3RyaW5naWZ5KGl0ZW1zKSk7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wcm9qZWN0XCIpW2luZGV4XS5yZW1vdmUoKTtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiI3Byb2plY3Qtc2VsZWN0IG9wdGlvblwiKVtpbmRleCAtIDFdLnJlbW92ZSgpO1xuICAgIHJlbmRlcigpO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZVByb2plY3QoaXRlbSkge1xuICAgIGNvbnN0IHByb2plY3RDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2plY3QtY29udGFpbmVyXCIpO1xuICAgIGNvbnN0IHByb2plY3RJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBwcm9qZWN0SXRlbS5jbGFzc0xpc3QuYWRkKFwicHJvamVjdFwiKTtcbiAgICBwcm9qZWN0SXRlbS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpdGVtLm5hbWUpO1xuICAgIHByb2plY3RDb250YWluZXIuYXBwZW5kQ2hpbGQocHJvamVjdEl0ZW0pO1xuICAgIGNvbnN0IHByb2plY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgICBwcm9qZWN0LnRleHRDb250ZW50ID0gaXRlbS5uYW1lO1xuICAgIHByb2plY3RJdGVtLmFwcGVuZENoaWxkKHByb2plY3QpO1xuXG4gICAgaWYgKCFpdGVtLnByb3RlY3RlZCkge1xuICAgICAgY29uc3QgcHJvamVjdERlbGV0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgICBwcm9qZWN0RGVsZXRlLnRleHRDb250ZW50ID0gXCJERUxcIjtcbiAgICAgIHByb2plY3RJdGVtLmFwcGVuZENoaWxkKHByb2plY3REZWxldGUpO1xuICAgICAgcHJvamVjdERlbGV0ZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IHRoaXMucGFyc2VQcm9qZWN0cygpO1xuICAgICAgICBjb25zdCBpbmRleCA9IHByb2plY3RzLmZpbmRJbmRleChcbiAgICAgICAgICAoc2VhcmNoRm9yKSA9PiBzZWFyY2hGb3IubmFtZSA9PT0gaXRlbS5uYW1lXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMucmVtb3ZlUHJvamVjdHMoaW5kZXgpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgaXRlbS5uYW1lICE9PSBcIkluYm94XCIgJiZcbiAgICAgIGl0ZW0ubmFtZSAhPT0gXCJUb2RheVwiICYmXG4gICAgICBpdGVtLm5hbWUgIT09IFwiTGF0ZVwiXG4gICAgKSB7XG4gICAgICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2plY3Qtc2VsZWN0XCIpO1xuICAgICAgY29uc3QgbmV3T3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICAgIG5ld09wdGlvbi52YWx1ZSA9IGl0ZW0ubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgbmV3T3B0aW9uLnRleHRDb250ZW50ID0gaXRlbS5uYW1lO1xuICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKG5ld09wdGlvbik7XG4gICAgfVxuXG4gICAgcHJvamVjdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgbG9jYWxMaXN0ID0gcGFyc2VMb2NhbFN0b3JhZ2UoKTtcbiAgICAgIGlmIChpdGVtLm5hbWUgPT09IFwiSW5ib3hcIikge1xuICAgICAgICByZW5kZXIoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXRlbS5uYW1lID09PSBcIlRvZGF5XCIpIHtcbiAgICAgICAgY29uc3QgZmlsdGVyZWRMaXN0ID0gbG9jYWxMaXN0LmZpbHRlcigobG9jYWxJdGVtKSA9PiB7XG4gICAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCkudG9KU09OKCk7XG4gICAgICAgICAgY29uc3QgY3VycmVudERhdGUgPSBEYXRlLnBhcnNlKGRhdGUpO1xuICAgICAgICAgIGNvbnN0IGxvY2FsSXRlbURhdGUgPSBEYXRlLnBhcnNlKGxvY2FsSXRlbS5kYXRlKTtcbiAgICAgICAgICByZXR1cm4gbG9jYWxJdGVtRGF0ZSA8IGN1cnJlbnREYXRlO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVuZGVyKGZpbHRlcmVkTGlzdCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZmlsdGVyZWRMaXN0ID0gbG9jYWxMaXN0LmZpbHRlcihcbiAgICAgICAgKGxvY2FsSXRlbSkgPT4gbG9jYWxJdGVtLnByb2plY3QgPT09IGl0ZW0ubmFtZS50b0xvd2VyQ2FzZSgpXG4gICAgICApO1xuICAgICAgcmVuZGVyKGZpbHRlcmVkTGlzdCk7XG4gICAgfSk7XG4gIH1cblxuICBzdGF0aWMgbmV3UHJvamVjdChpdGVtKSB7XG4gICAgdGhpcy5jcmVhdGVQcm9qZWN0KGl0ZW0pO1xuICAgIHRoaXMuYWRkUHJvamVjdHMoaXRlbSk7XG4gICAgcmVuZGVyKCk7XG4gIH1cbn1cbiIsImltcG9ydCB7IHNhdmVUb0RvLCByZW5kZXIgfSBmcm9tIFwiLi90b2RvXCI7XG5pbXBvcnQgUHJvamVjdHMgZnJvbSBcIi4vcHJvamVjdHNcIjtcblxuLy8gZnVuY3Rpb24gZm9yIGNhbmNlbCBidXR0b25cbmZ1bmN0aW9uIGNhbmNlbEJ1dHRvbigpIHtcbiAgY29uc3QgY2FuY2VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYW5jZWxcIik7XG4gIGNhbmNlbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgZm9ybUNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybS1jb250YWluZXJcIik7XG4gICAgLy8gY29uc29sZS5sb2coXCJkb25lXCIpO1xuICAgIGZvcm1Db250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZShcImhpZGRlblwiKTtcbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpO1xuICAgIC8vIHNldCB2YWx1ZXMgdG8gZGVmYXVsdFxuICAgIGZvcm0udGFzay52YWx1ZSA9IFwiXCI7XG4gICAgZm9ybS5kZXNjcmlwdGlvbi52YWx1ZSA9IFwiXCI7XG4gICAgZm9ybS5kYXR1bS52YWx1ZSA9IFwiXCI7XG4gIH0pO1xufVxuXG4vLyBmdW5jdGlvbiBmb3IgYWRkIGJ1dHRvblxuZnVuY3Rpb24gYWRkQnV0dG9uKCkge1xuICBjb25zdCBhZGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3N1Ym1pdFwiKTtcbiAgYWRkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBmb3JtQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5mb3JtLWNvbnRhaW5lclwiKTtcbiAgICBmb3JtQ29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoXCJoaWRkZW5cIik7XG4gICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybVwiKTtcbiAgICBzYXZlVG9Ebyhmb3JtKTtcbiAgICAvLyBzZXQgdmFsdWVzIHRvIGRlZmF1bHRcbiAgICBmb3JtLnJlc2V0KCk7XG4gICAgcmVuZGVyKCk7XG4gIH0pO1xufVxuXG4vLyBmdW5jdGlvbiBmb3IgbmV3IGJ1dHRvblxuZnVuY3Rpb24gbmV3QnV0dG9uKCkge1xuICBjb25zdCBuZXdCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm5ldy1idXR0b25cIik7XG4gIG5ld0J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGZvcm1Db250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmZvcm0tY29udGFpbmVyXCIpO1xuICAgIGZvcm1Db250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZShcImhpZGRlblwiKTtcbiAgfSk7XG59XG5cbi8vIGZ1bmN0aW9uIGZvciBwcm9qZWN0IGJ1dHRvblxuZnVuY3Rpb24gYWRkUHJvamVjdCgpIHtcbiAgY29uc3QgcHJvamVjdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvamVjdC1idXR0b25cIik7XG4gIHByb2plY3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBwcm9qZWN0TmFtZSA9IHByb21wdChcIlBsZWFzZSBlbnRlciBhIHByb2plY3QgbmFtZTpcIiwgXCJOZXcgUHJvamVjdFwiKTtcbiAgICBpZiAoIXByb2plY3ROYW1lKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHByb2plY3RPYmogPSB7XG4gICAgICBuYW1lOiBwcm9qZWN0TmFtZSxcbiAgICAgIHByb3RlY3RlZDogZmFsc2UsXG4gICAgfTtcbiAgICBQcm9qZWN0cy5uZXdQcm9qZWN0KHByb2plY3RPYmopO1xuICB9KTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gYnV0dG9uRnVuY3Rpb25zKCkge1xuICBjYW5jZWxCdXR0b24oKTtcbiAgYWRkQnV0dG9uKCk7XG4gIG5ld0J1dHRvbigpO1xuICBhZGRQcm9qZWN0KCk7XG59XG4iLCJpbXBvcnQgY3JlYXRlU3RydWN0dXJlIGZyb20gXCIuL21vZHVsZXMvdWlcIjtcbmltcG9ydCBidXR0b25GdW5jdGlvbnMgZnJvbSBcIi4vbW9kdWxlcy9idXR0b24tZnVuY3Rpb25zXCI7XG5pbXBvcnQgeyByZW5kZXIgfSBmcm9tIFwiLi9tb2R1bGVzL3RvZG9cIjtcbmltcG9ydCBQcm9qZWN0cyBmcm9tIFwiLi9tb2R1bGVzL3Byb2plY3RzXCI7XG5cbmNyZWF0ZVN0cnVjdHVyZSgpO1xuYnV0dG9uRnVuY3Rpb25zKCk7XG5Qcm9qZWN0cy5yZW5kZXJQcm9qZWN0cygpO1xucmVuZGVyKCk7XG4iXSwibmFtZXMiOlsiYm9keSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInBhcnNlTG9jYWxTdG9yYWdlIiwiSlNPTiIsInBhcnNlIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInJlbmRlciIsImxpc3QiLCJ0ZXh0Q29udGVudCIsImZvckVhY2giLCJpdGVtIiwiaWQiLCJUYXNrIiwidGFzayIsImRlc2NyaXB0aW9uIiwiZGF0ZSIsImNvbXBsZXRlZCIsInByb2plY3QiLCJwcmlvcml0eSIsInRvRG9zIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsImNvbnN0cnVjdG9yIiwibGlzdElkIiwidGl0bGUiLCJ0aGlzIiwiY3JlYXRlVGFza0NvbnRhaW5lciIsImluYm94IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwiY29uc29sZSIsImxvZyIsInRhc2tGb3JtIiwidmFsdWUiLCJyZWFkT25seSIsInByb2plY3RTZWxlY3QiLCJkaXNhYmxlZCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJvcHQiLCJuZXdPcHRpb24iLCJsYWJlbCIsImVkaXRCdG4iLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInByZXZlbnREZWZhdWx0IiwidG9nZ2xlIiwiZXZlbnQiLCJkYXRhIiwidGFza1RpdGxlIiwidGFza0Rlc2NyaXB0aW9uIiwidGFza0RhdGUiLCJkZWxldGVCdG4iLCJkZWwiLCJzcGxpY2UiLCJyZW1vdmUiLCJQcm9qZWN0cyIsInN0YXRpYyIsIm5hbWUiLCJwcm90ZWN0ZWQiLCJwYXJzZVByb2plY3RzIiwiY3JlYXRlUHJvamVjdCIsIml0ZW1zIiwibGVuZ3RoIiwicHJvamVjdHMiLCJwdXNoIiwiaW5kZXgiLCJwcm9qZWN0Q29udGFpbmVyIiwicHJvamVjdEl0ZW0iLCJwcm9qZWN0RGVsZXRlIiwiZmluZEluZGV4Iiwic2VhcmNoRm9yIiwicmVtb3ZlUHJvamVjdHMiLCJzZWxlY3QiLCJ0b0xvd2VyQ2FzZSIsImxvY2FsTGlzdCIsImZpbHRlciIsImxvY2FsSXRlbSIsIkRhdGUiLCJ0b0pTT04iLCJjdXJyZW50RGF0ZSIsImFkZFByb2plY3RzIiwiZGl2IiwibmV3QnV0dG9uIiwiYWRkUHJvamVjdEJ1dHRvbiIsImNyZWF0ZVNpZGViYXIiLCJjcmVhdGVUb2RvIiwiY29udGFpbmVyIiwibWFpbiIsImZvcm0iLCJ0YXNrTGFiZWwiLCJkZXNjcmlwdGlvbkxhYmVsIiwiZGF0dW1MYWJlbCIsImRhdHVtIiwib3B0aW9uRGVmYXVsdCIsInByaW9yaXR5U2VsZWN0Iiwib3B0aW9uT25lIiwib3B0aW9uVHdvIiwib3B0aW9uVGhyZWUiLCJhZGRCdXR0b24iLCJjYW5jZWxCdXR0b24iLCJjcmVhdGVGb3JtIiwidG9EbyIsInByb2plY3RzZWxlY3QiLCJwcmlvcml0eXNlbGVjdCIsInNhdmVUb0RvIiwicmVzZXQiLCJwcm9qZWN0TmFtZSIsInByb21wdCIsInByb2plY3RPYmoiLCJuZXdQcm9qZWN0IiwicmVuZGVyUHJvamVjdHMiXSwic291cmNlUm9vdCI6IiJ9